@model MovieTicketReservation.ViewModels.ReserveSeatsViewModel

<h2 class ="text-center">@Model.MovieShowStart</h2>
<h3 class ="text-center">Movie @Model.Title</h3>

<div class="p-3 mb-2 bg-dark text-white">Screen</div>

<div class="row justify-content-center align-items-center">
    <form asp-controller="Reservation" asp-action="ReserveSeats" method="post">
        <div class="form-group">
            <h5>Select a seat</h5>

            <div class="row">
                @for (int row = 1; row <= Model.HallRows; row++)
                {
                    <br></br>
                    <h5>Row @row:</h5>
                    <br></br>
                    <div class="row">
                        @for (int seat = 1; seat <= Model.HallCapacity; seat++)
                        {
                            if (seat <= 10)
                            {

                                int actualSeatNumber = (row - 1) * 10 + seat;
                                bool isReserved = Model.ReservedSeats.Contains(actualSeatNumber);



                                <div class="col-md-1">
                                    <input type="checkbox" id="@($"Seat-{actualSeatNumber}")" name="Seats" value="@actualSeatNumber"
                                    @(isReserved ? "disabled" : "") class="custom-checkbox" />
                                    <label for="@($"Seat-{actualSeatNumber}")" class="@(isReserved ? "reserved-seat" : "")"></label>
                                    Seat @actualSeatNumber
                                </div>
                            }

                        }
                    </div>
                }
            </div>

        </div>




        <input type="hidden" name="Created" value="@DateTime.Now" />
        <input type="hidden" name="MovieShowId" value="@Model.MovieShowId" />
        <input type="hidden" name="Price" value="4" />


        <button type="submit" class="btn btn-primary">Reserve Seats</button>
        <div>
            <span id="ticketPrice"></span>
        </div>
    </form>
</div>



<script>
    
    function updatePrice() {
        var totalPrice = 0;
        
        $("input[name='Seats']:checked").each(function () {
            totalPrice += 4;
        });
        
        $("#ticketPrice").text("Total Price: $" + totalPrice.toString() );
    }

    
    $("input[name='Seats']").change(function () {
        updatePrice();
    });

    
    $("form").submit(function (event) {
        event.preventDefault(); 

        var formData = $(this).serialize();

        $.ajax({
            type: "POST",
            url: '@Url.Action("ReserveSeats", "Reservation")',
            data: formData,
            success: function (response) {
                
                console.log(response);
            },
            error: function (xhr, status, error) {
                
                console.error(error);
            }
        });
    });

    
    $("input[name='selectedSeats']").change(function () {
        updatePrice();
    });

    
    updatePrice();

    
</script>
